<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¼å¼¹å‘å°„æ¨¡æ‹Ÿå™¨</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #000;
            color: white;
            overflow: hidden; /* éšè—æ‰€æœ‰æ»šåŠ¨æ¡ */
            height: 100vh; /* é™åˆ¶é«˜åº¦ä¸ºè§†å£é«˜åº¦ */
            width: 100vw; /* é™åˆ¶å®½åº¦ä¸ºè§†å£å®½åº¦ */
            position: fixed; /* é˜²æ­¢é¡µé¢æ»šåŠ¨ */
        }
        
        .header {
            background: linear-gradient(to bottom, #000033, #000066);
            color: white;
            text-align: center;
            padding: 1rem;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 15vh; /* å‡å°é«˜åº¦ä»¥èŠ‚çœç©ºé—´ */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 0 0 10px rgba(255,255,255,0.5);
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 1rem;
            background: linear-gradient(to bottom, #000066, #000033);
            height: 85vh; /* é«˜åº¦ä¸ºå‰©ä½™ç©ºé—´ */
            overflow-y: auto; /* å†…å®¹è¿‡å¤šæ—¶å…è®¸å†…éƒ¨æ»šåŠ¨ */
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .missile-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }
        
        .missile {
            position: absolute;
            font-size: 3rem;
            opacity: 0;
            transition: transform 0.2s ease;
            pointer-events: none;
            z-index: 1001;
            text-shadow: 0 0 15px rgba(255, 0, 0, 0.8);
            transform-origin: center center;
        }
        
        .missile img {
            width: 60px;
            height: auto;
            filter: drop-shadow(0 0 10px rgba(255, 0, 0, 0.8));
        }
        
        .missile-cover {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 120px;
            height: 120px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(255, 77, 77, 0.5);
            z-index: 100;
            background-color: rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(255, 77, 77, 0.7);
        }
        
        .missile-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .explosion {
            position: absolute;
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, rgba(255,255,0,0.8) 0%, rgba(255,0,0,0.8) 50%, rgba(0,0,0,0) 100%);
            border-radius: 50%;
            animation: explode 0.5s forwards;
            z-index: 1002;
        }
        
        @keyframes explode {
            0% {
                transform: scale(0.1);
                opacity: 0.8;
            }
            100% {
                transform: scale(2);
                opacity: 0;
            }
        }
        
        .missile.active {
            opacity: 1;
        }
        
        .launch-button {
            background: linear-gradient(to bottom, #ff3333, #cc0000);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 2rem;
            box-shadow: 0 0 20px rgba(255,0,0,0.5);
            transition: all 0.3s ease;
        }
        
        .launch-button:hover {
            background: linear-gradient(to bottom, #ff6666, #ff0000);
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(255,0,0,0.8);
        }
        
        .launch-button:active {
            transform: scale(0.95);
        }
        
        .nav-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .nav-button {
            background: linear-gradient(to bottom, #333366, #000033);
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 1rem;
            border-radius: 5px;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0,0,255,0.3);
            transition: all 0.3s ease;
        }
        
        .nav-button:hover {
            background: linear-gradient(to bottom, #4444aa, #222266);
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(0,0,255,0.5);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>å¯¼å¼¹å‘å°„æ¨¡æ‹Ÿå™¨</h1>
        <p>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å‘å°„å¯¼å¼¹ï¼Œå¯¼å¼¹å°†è·Ÿéšé¼ æ ‡ç§»åŠ¨ã€‚å½“å¯¼å¼¹æ¥è§¦å±å¹•è¾¹ç¼˜æ—¶ï¼Œå°†ä¼šå‘ç”Ÿçˆ†ç‚¸ã€‚</p>
        <button id="launchButton" class="launch-button">å‘å°„å¯¼å¼¹ï¼</button>
        
        <div class="nav-buttons">
            <a href="index.html" class="nav-button">è¿”å›å¯¼å¼¹å±•ç¤ºé¡µ</a>
            <button id="resetButton" class="nav-button" style="margin-left: 10px;">é‡æ–°å‘å°„</button>
        </div>
    </div>
    
    <div class="missile-container" id="missileContainer"></div>
    
    <audio id="launchSound" src="audio/rocket-launch.mp3" preload="auto"></audio>
    <audio id="explosionSound" src="audio/whoosh.mp3" preload="auto"></audio>
    
    <script>
        // å…¨å±€å˜é‡
        let missileActive = false;
        let mouseX = 0;
        let mouseY = 0;
        let missileElement = null;
        let missileX = 0;
        let missileY = 0;
        let missileAngle = 0;
        let animationFrameId = null;
        let lastMouseX = 0; // è®°å½•ä¸Šä¸€å¸§é¼ æ ‡Xä½ç½®
        let lastMouseY = 0; // è®°å½•ä¸Šä¸€å¸§é¼ æ ‡Yä½ç½®
        let selectedMissileType = ''; // å½“å‰é€‰æ‹©çš„å¯¼å¼¹ç±»å‹
        let missileImagePath = ''; // å¯¼å¼¹å›¾ç‰‡è·¯å¾„
        
        // è·å–DOMå…ƒç´ 
        const missileContainer = document.getElementById('missileContainer');
        const launchButton = document.getElementById('launchButton');
        const resetButton = document.getElementById('resetButton');
        const launchSound = document.getElementById('launchSound');
        const explosionSound = document.getElementById('explosionSound');
        
        // è·å–URLå‚æ•°
        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            var results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }
        
        // æ£€æŸ¥æ˜¯å¦éœ€è¦è‡ªåŠ¨å‘å°„
        function checkAutoLaunch() {
            const autoLaunch = getUrlParameter('autolaunch');
            if (autoLaunch === 'true') {
                // ä» localStorage è·å–å¯¼å¼¹ç±»å‹
                selectedMissileType = localStorage.getItem('selectedMissileType') || 'strategic';
                console.log('è‡ªåŠ¨å‘å°„å¯¼å¼¹ç±»å‹:', selectedMissileType);
                
                // è·å–å¯¼å¼¹å›¾ç‰‡è·¯å¾„
                missileImagePath = localStorage.getItem('missileImagePath') || `images/${selectedMissileType}.png`;
                
                // æ›´æ–°é¡µé¢æ ‡é¢˜
                document.querySelector('h1').textContent = `${getMissileTypeName(selectedMissileType)}å‘å°„æ¨¡æ‹Ÿå™¨`;
                
                // æ˜¾ç¤ºå¯¼å¼¹å°é¢å›¾
                displayMissileCover(missileImagePath);
                
                // è‡ªåŠ¨å‘å°„å¯¼å¼¹
                setTimeout(function() {
                    launchButton.click();
                }, 500);
            }
        }
        
        // æ˜¾ç¤ºå¯¼å¼¹å°é¢å›¾
        function displayMissileCover(imagePath) {
            // åˆ›å»ºå°é¢å›¾å®¹å™¨
            const coverContainer = document.createElement('div');
            coverContainer.className = 'missile-cover';
            
            // åˆ›å»ºå›¾ç‰‡å…ƒç´ 
            const coverImage = document.createElement('img');
            coverImage.src = imagePath;
            coverImage.alt = getMissileTypeName(selectedMissileType);
            
            // æ·»åŠ åˆ°å®¹å™¨
            coverContainer.appendChild(coverImage);
            document.body.appendChild(coverContainer);
        }
        
        // è·å–å¯¼å¼¹ç±»å‹åç§°
        function getMissileTypeName(type) {
            const typeNames = {
                'strategic': 'æˆ˜ç•¥å¯¼å¼¹',
                'cruise': 'å·¡èˆªå¯¼å¼¹',
                'antiair': 'é˜²ç©ºå¯¼å¼¹'
            };
            return typeNames[type] || 'å¯¼å¼¹';
        }
        
        // ç›‘å¬é¼ æ ‡ç§»åŠ¨
        document.addEventListener('mousemove', function(e) {
            mouseX = e.clientX;
            mouseY = e.clientY;
            
            // å¦‚æœå¯¼å¼¹æ´»åŠ¨ä¸­ï¼Œç›´æ¥æ›´æ–°å¯¼å¼¹ä½ç½®
            if (missileActive && missileElement) {
                missileElement.style.left = (mouseX - 15) + 'px';
                missileElement.style.top = (mouseY - 15) + 'px';
                
                // è®¡ç®—æ—‹è½¬è§’åº¦
                if (lastMouseX !== 0 && lastMouseY !== 0) {
                    const dx = mouseX - lastMouseX;
                    const dy = mouseY - lastMouseY;
                    if (Math.abs(dx) > 1 || Math.abs(dy) > 1) { // é˜²æ­¢å¾®å°ç§»åŠ¨å¼•èµ·æ—‹è½¬
                        missileAngle = Math.atan2(dy, dx) * 180 / Math.PI;
                        missileElement.style.transform = `rotate(${missileAngle}deg)`;
                    }
                }
                
                lastMouseX = mouseX;
                lastMouseY = mouseY;
            }
        });
        
        // å‘å°„å¯¼å¼¹
        launchButton.addEventListener('click', function() {
            // å¦‚æœå·²ç»æœ‰æ´»åŠ¨çš„å¯¼å¼¹ï¼Œå…ˆåœæ­¢å®ƒ
            if (missileActive) {
                missileActive = false;
                if (missileElement) {
                    missileElement.remove();
                    missileElement = null;
                }
            }
            
            // æ ¹æ®å¯¼å¼¹ç±»å‹æ›´æ–°æ ‡é¢˜
            if (selectedMissileType) {
                document.querySelector('h1').textContent = `${getMissileTypeName(selectedMissileType)}å‘å°„æ¨¡æ‹Ÿå™¨`;
            }
            
            // åˆ›å»ºæ–°çš„å¯¼å¼¹å…ƒç´ 
            missileElement = document.createElement('div');
            missileElement.className = 'missile active';
            
            // ä½¿ç”¨å›¾ç‰‡è€Œä¸æ˜¯emoji
            if (missileImagePath) {
                const missileImg = document.createElement('img');
                missileImg.src = missileImagePath;
                missileImg.alt = getMissileTypeName(selectedMissileType);
                missileElement.appendChild(missileImg);
            } else {
                missileElement.innerHTML = 'ğŸ’¥'; // ä½¿ç”¨çˆ†ç‚¸å›¾æ ‡ä½œä¸ºå¤‡ç”¨
            }
            
            missileContainer.appendChild(missileElement);
            console.log('å¯¼å¼¹å·²åˆ›å»º');
            
            // åˆå§‹ä½ç½®ç›´æ¥è®¾ç½®ä¸ºé¼ æ ‡ä½ç½®
            missileX = mouseX;
            missileY = mouseY;
            missileElement.style.left = (missileX - 15) + 'px'; // è°ƒæ•´ä½ç½®ä½¿å…¶å±…ä¸­
            missileElement.style.top = (missileY - 15) + 'px';
            console.log('å¯¼å¼¹åˆå§‹ä½ç½®:', missileX, missileY);
            
            // æ’­æ”¾éŸ³æ•ˆ
            launchSound.currentTime = 0;
            launchSound.play().catch(error => {
                console.error('æ’­æ”¾å‘å°„éŸ³æ•ˆå¤±è´¥:', error);
            });
            
            // æ¿€æ´»å¯¼å¼¹
            missileActive = true;
            
            // å¼€å§‹åŠ¨ç”»
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
            }
            animationFrameId = requestAnimationFrame(animateMissile);
        });
        
        // åˆ›å»ºçˆ†ç‚¸æ•ˆæœ
        function createExplosion(x, y) {
            const explosion = document.createElement('div');
            explosion.className = 'explosion';
            explosion.style.left = (x - 40) + 'px'; // è°ƒæ•´ä½ç½®ä½¿å…¶å±…ä¸­
            explosion.style.top = (y - 40) + 'px';
            missileContainer.appendChild(explosion);
            
            // æ’­æ”¾çˆ†ç‚¸éŸ³æ•ˆ
            explosionSound.currentTime = 0;
            explosionSound.play().catch(error => {
                console.error('æ’­æ”¾çˆ†ç‚¸éŸ³æ•ˆå¤±è´¥:', error);
            });
            
            // ç§»é™¤çˆ†ç‚¸æ•ˆæœ
            setTimeout(() => {
                explosion.remove();
            }, 500);
        }
        
        // å¯¼å¼¹åŠ¨ç”»
        function animateMissile() {
            if (!missileActive || !missileElement) return;
            
            // è®¡ç®—å¯¼å¼¹ä¸é¼ æ ‡ä¹‹é—´çš„è·ç¦»å’Œè§’åº¦
            const dx = mouseX - missileX;
            const dy = mouseY - missileY;
            const distance = Math.sqrt(dx * dx + dy * dy);
            const targetAngle = Math.atan2(dy, dx) * 180 / Math.PI;
            
            // å¹³æ»‘æ—‹è½¬å¯¼å¼¹
            const angleDiff = targetAngle - missileAngle;
            missileAngle += angleDiff * 0.1;
            
            // ç›´æ¥æ›´æ–°å¯¼å¼¹ä½ç½®ä¸ºé¼ æ ‡ä½ç½®
            missileX = mouseX;
            missileY = mouseY;
            
            // åº”ç”¨ä½ç½®å’Œæ—‹è½¬ - ç²¾ç¡®è·Ÿéšé¼ æ ‡
            missileElement.style.left = (mouseX - 15) + 'px'; // ç›´æ¥è·Ÿéšé¼ æ ‡ä½ç½®ï¼Œåç§»é‡ä¸ºå›¾æ ‡å¤§å°çš„ä¸€åŠ
            missileElement.style.top = (mouseY - 15) + 'px';
            missileElement.style.transform = `rotate(${missileAngle}deg)`;
            
            // æ£€æµ‹æ˜¯å¦æ¥è¿‘è¾¹ç•Œ
            const margin = 50; // å¢åŠ è¾¹è·ï¼Œä½¿å¯¼å¼¹åœ¨è¾¾åˆ°è¾¹ç•Œå‰åœæ­¢
            
            // é™åˆ¶å¯¼å¼¹ä½ç½®ï¼Œä¸å…è®¸è¶…å‡ºè¾¹ç•Œ
            let hitBoundary = false;
            let explosionX = mouseX;
            let explosionY = mouseY;
            
            // æ£€æŸ¥å·¦è¾¹ç•Œ
            if (mouseX < margin) {
                explosionX = margin;
                hitBoundary = true;
            }
            // æ£€æŸ¥å³è¾¹ç•Œ
            else if (mouseX > window.innerWidth - margin) {
                explosionX = window.innerWidth - margin;
                hitBoundary = true;
            }
            
            // æ£€æŸ¥ä¸Šè¾¹ç•Œ
            if (mouseY < margin) {
                explosionY = margin;
                hitBoundary = true;
            }
            // æ£€æŸ¥ä¸‹è¾¹ç•Œ
            else if (mouseY > window.innerHeight - margin) {
                explosionY = window.innerHeight - margin;
                hitBoundary = true;
            }
            
            if (hitBoundary) {
                // åœ¨è¾¹ç•Œå¤„è§¦å‘çˆ†ç‚¸æ•ˆæœ
                createExplosion(explosionX, explosionY);
                
                // åœæ­¢å¯¼å¼¹ç§»åŠ¨ï¼Œä½†ä¸ç§»é™¤å¯¼å¼¹
                missileActive = false;
                
                // åœ¨çˆ†ç‚¸åä½¿å¯¼å¼¹éšè—
                if (missileElement) {
                    missileElement.style.opacity = '0';
                }
                return;
            }
            
            // ç»§ç»­åŠ¨ç”»
            animationFrameId = requestAnimationFrame(animateMissile);
        }
        
        // é‡ç½®æŒ‰é’®äº‹ä»¶
        resetButton.addEventListener('click', function() {
            // é‡æ–°åŠ è½½é¡µé¢
            window.location.reload();
        });
        
        // é¡µé¢åŠ è½½æ—¶åˆ›å»ºæ˜Ÿæ˜Ÿå¹¶æ£€æŸ¥æ˜¯å¦è‡ªåŠ¨å‘å°„
        window.addEventListener('load', function() {
            // åˆ›å»ºæ˜Ÿæ˜ŸèƒŒæ™¯
            const stars = document.createElement('div');
            stars.className = 'stars';
            document.body.appendChild(stars);
            
            for (let i = 0; i < 200; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                star.style.opacity = Math.random();
                stars.appendChild(star);
            }
            
            // æ£€æŸ¥URLå‚æ•°ä¸­æ˜¯å¦æœ‰å›¾ç‰‡è·¯å¾„
            const imgParam = getUrlParameter('img');
            if (imgParam) {
                missileImagePath = decodeURIComponent(imgParam);
                console.log('ä»URLè·å–å¯¼å¼¹å›¾ç‰‡è·¯å¾„:', missileImagePath);
                displayMissileCover(missileImagePath);
            }
            
            // æ£€æŸ¥æ˜¯å¦éœ€è¦è‡ªåŠ¨å‘å°„
            checkAutoLaunch();
        });
    </script>
</body>
</html>
